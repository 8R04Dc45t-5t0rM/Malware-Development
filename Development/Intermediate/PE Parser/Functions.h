#include "MyDefs.h"


int IsPE(FILE *f){
    IMAGE_DOS_HEADER DOS_FileHeader;

    // DOS header  
    fseek(f,0,SEEK_SET);
    fread(&DOS_FileHeader,sizeof(IMAGE_DOS_HEADER),1,f);

    if(DOS_FileHeader.e_magic != IMAGE_DOS_SIGNATURE){
        printf("THIS IS NOT A PE! ");
        return 0;
    }

    // NT header
    fseek(f,DOS_FileHeader.e_lfanew+ sizeof(DWORD) + sizeof(IMAGE_FILE_HEADER),SEEK_SET);
    WORD Magic;
    fread(&Magic,sizeof(WORD),1,f);

    if(Magic == IMAGE_NT_OPTIONAL_HDR32_MAGIC){
        printf("this is a 32 PE\n");
        return 32;
    }
    else if(Magic == IMAGE_NT_OPTIONAL_HDR64_MAGIC){
        printf("This ia a 64 PE\n");
        return 64;
    }
    else {
        printf("This PE type isnt known.\n");
        return 0;
    }

}

